# UN_Prod


### **Документация проекта**

---

## **1. Основные файлы проекта**

### **main.py**
Этот файл является точкой входа в программу. Он включает вызовы для обеспечения наличия необходимых директорий, генерации примера данных и сохранения датасета.

**Основные функции:**
- `ensure_dictionaries()`: Проверяет наличие и создает необходимые словари.
- `ensure_directory_exists(path)`: Проверяет, существует ли директория, и создает её при необходимости.
- `generate_combined_example(dictionaries)`: Генерирует комбинированный пример, используя шаблоны для имени, адреса, телефона и email.
- `generate_and_save_dataset()`: Генерирует датасет, анализирует сущности и сохраняет результат в формате CoNLL.

Пример использования:
```bash
python main.py
```

---

### **annotation.py**
Этот файл содержит функции для работы с разметкой BIO. Он отвечает за обработку и корректировку меток для извлеченных сущностей, таких как имя, адрес, телефон и email.

**Основные функции:**
- `post_process_bio_tags(words, labels)`: Пост-обработка BIO-тегов для обеспечения корректной последовательности.
- `tokenize_text_with_positions(text)`: Токенизация текста с указанием позиций токенов.
- `assign_bio_labels(words, positions, entity_tokens)`: Присваивает метки сущностям в тексте.
- `handle_prefixes(words, positions, labels)`: Обрабатывает префиксы сущностей (например, "г." для городов).
- `fix_bio_errors(words, labels)`: Исправляет ошибки в BIO-разметке.
- `add_phone_and_email_labels(words, labels, dictionaries)`: Добавляет метки для телефонных номеров и email-адресов.
- `create_bio_annotations(text, entity_tokens, dictionaries)`: Основная функция для создания BIO-разметки.

---

### **data_generation.py**
Файл для генерации случайных данных на основе шаблонов и словарей. Он генерирует данные для таких сущностей, как имя, адрес, телефон и email, используя шаблоны и библиотеки Faker.

**Основные функции:**
- `load_templates(file_path='templates.json')`: Загружает шаблоны из указанного JSON файла.
- `generate_address(dictionaries)`: Генерирует случайный адрес, используя шаблоны и словари.
- `generate_person()`: Генерирует случайное имя, фамилию и отчество.
- `generate_phone()`: Генерирует случайный телефонный номер.
- `generate_email()`: Генерирует случайный email-адрес.
- `generate_combined_example(dictionaries)`: Генерирует комбинированный пример с именем, адресом, телефоном и email, используя случайные шаблоны.

---

### **dataset_utils.py**
Этот файл отвечает за создание, сохранение и анализ датасетов, используя сгенерированные примеры. Датасеты сохраняются в формате CoNLL, который используется для обучения моделей с метками BIO.

**Основные функции:**
- `save_conll_dataset(dataset, filename="dataset.conll")`: Сохраняет датасет в формате CoNLL.
- `analyze_entity_count(dataset)`: Анализирует количество сущностей каждого типа в датасете.
- `count_real_entities(dataset)`: Подсчитывает реальное количество сущностей, игнорируя префиксы и пунктуацию.
- `generate_and_save_dataset(num_samples=1000, filename="dataset.conll")`: Генерирует и сохраняет датасет с нужными метками.

---

### **tokenization.py**
Этот файл содержит функции для поиска сущностей в тексте и их нормализации. Он использует несколько методов для нахождения сущностей в тексте и их дальнейшего разбиения.

**Основные функции:**
- `expand_entity_map_with_prefixes(entity_map, text)`: Расширяет маппинг сущностей, добавляя префиксы для городов и улиц.
- `find_sentence_start_entities(text, entity_map)`: Находит сущности, начинающиеся с предложений.
- `find_line_start_entities(text, entity_map)`: Находит сущности, начинающиеся с первой строки.
- `search_entities_in_text(normalized_text, expanded_entity_map, original_entity_map, original_text)`: Ищет сущности в тексте.
- `filter_overlapping_tokens(tokens)`: Фильтрует пересекающиеся сущности.
- `find_phone_and_email_tokens(text, entity_map, dictionaries)`: Ищет телефонные номера и email-адреса в тексте.
- `find_entity_tokens(text, entity_map, dictionaries)`: Основная функция для поиска всех сущностей в тексте.

---

### **utils.py**
В этом файле содержатся вспомогательные функции для работы с файлом и директорией, а также функции для загрузки и создания словарей с данными для генерации.

**Основные функции:**
- `load_dictionary(entity_type, default_generator=None, num_fallback=50)`: Загружает словарь сущностей из файла или создает новый с помощью генератора.
- `ensure_dictionaries()`: Проверяет наличие и создает необходимые словари.
- `ensure_directory_exists(path)`: Проверяет, существует ли директория, и создает её при необходимости.

---

### **templates_combined_example.json**
Этот JSON файл содержит шаблоны для генерации комбинированных примеров, включающих имя, адрес, телефон и email.

**Пример структуры:**
```json
{
    "address_templates": [
        "{СТРАНА}, {РЕГИОН}, г. {ГОРОД}, ул. {УЛИЦА}, д. {ЧИСЛО}",
        "г. {ГОРОД}, ул. {УЛИЦА}, д. {ЧИСЛО}"
    ],
    "name_templates": [
        "{ИМЯ} {ФАМИЛИЯ}",
        "{ФАМИЛИЯ} {ИМЯ} {ОТЧЕСТВО}"
    ],
    "phone_templates": [
        "+7 (900) 123-45-67",
        "+7 900 123-45-67"
    ],
    "email_templates": [
        "{first_name}.{last_name}@gmail.com",
        "{first_name}_{last_name}@yahoo.com"
    ],
    "combined_example_templates": [
        "{name} проживает по адресу {address}. Телефон: {phone}, Email: {email}.",
        "{name} зарегистрирован по адресу {address}. Телефон: {phone}, Email: {email}."
    ]
}
```

---

## **2. Структура данных**

### **Словари**
Проект использует несколько словарей для генерации случайных данных, включая:
- **СТРАНА**: список стран
- **РЕГИОН**: список регионов
- **ГОРОД**: список городов
- **УЛИЦА**: список улиц
- **ЧИСЛО**: список чисел
- **PHONE**: список телефонных номеров
- **EMAIL**: список email-адресов

Эти данные загружаются из текстовых файлов, но если файлы отсутствуют, они генерируются с помощью библиотеки Faker или других генераторов.

### **Шаблоны**
Шаблоны данных используются для генерации примеров с именами, адресами, телефонами и email. Эти шаблоны могут быть расширены в файле `templates_combined_example.json`.

---

## **3. Формат данных**

Пример сгенерированного примера данных:
```
Москва, г. Таганрог, ул. Тюленина, д. 41
Телефон: 1-800-123-4567, Email: support@helpdesk.com
```

Для каждого слова в примере будет присвоена метка BIO:
```
Москва B-ГОРОД
, O
г. I-ГОРОД
Таганрог I-ГОРОД
, O
ул B-УЛИЦА
. I-УЛИЦА
Тюленина I-УЛИЦА
, O
д B-ГОРОД
. I-ГОРОД
41 B-ЧИСЛО
. O
Телефон O
: O
1 B-PHONE
-800-123-4567 I-PHONE
, O
Email O
: O
support@helpdesk B-EMAIL
 I-EMAIL
com I-EMAIL
. O
```

---

Эта документация будет полезна для разработчиков, которые будут работать с этим проектом, и для тех, кто будет использовать сгенерированные данные в дальнейшем.

